<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deutsch Lernspiel</title>
    <style>
        /* Reset и базовые стили для мобильных */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.4;
        }
        
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            background: white; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        h2 {
            font-size: 1.2em;
            margin-bottom: 12px;
            color: #444;
        }
        
        h3 {
            font-size: 1.1em;
            margin: 12px 0 8px;
            color: #555;
        }
        
        .section { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        
        /* НЕЙТРАЛЬНЫЕ КНОПКИ В МЕНЮ */
        .menu-btn { 
            padding: 12px 16px; 
            margin: 6px; 
            cursor: pointer; 
            border: none;
            border-radius: 8px;
            background: #6c757d; /* Нейтральный серый */
            color: white;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        
        .menu-btn.active { 
            background: #4CAF50; /* Зеленый при выборе */
        }
        
        .menu-btn:active {
            transform: scale(0.96);
        }
        
        .filter-btn { 
            background: #6c757d; 
            font-size: 13px;
            padding: 10px 14px;
        }
        
        .filter-btn.active {
            background: #2196F3;
        }
        
        input, select { 
            padding: 12px; 
            margin: 8px 0; 
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-size: 16px;
            min-height: 44px;
        }
        
        #quiz, #result { 
            display: none; 
            text-align: center; 
        }
        
        #answers button { 
            display: block; 
            width: 100%; 
            margin: 8px 0; 
            background: #666;
            font-size: 16px;
            padding: 16px;
            color: white;
        }

        /* Кнопки в ряд */
        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 10px 0;
        }

        .button-row button {
            flex: 1;
            min-width: calc(50% - 6px);
        }
        
        /* Адаптивные кнопки статуса изучения */
        .learning-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .status-btn {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            color: #333;
            min-height: 50px;
        }
        
        .status-btn:active {
            transform: scale(0.98);
        }
        
        /* Цвета для статусов */
        .word-learned {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }
        
        .article-learned {
            border-color: #2196F3;
            background: #2196F3;
            color: white;
        }
        
        .status-icon {
            font-size: 18px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        /* Прогресс бар */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* ИСПРАВЛЕННОЕ ОТОБРАЖЕНИЕ СЛОВА - АРТИКЛЬ СЛЕВА */
        #wordDisplay {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .word-container {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .article-display {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        .word-text {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            text-align: center;
            word-break: break-word;
        }
        
        .correct-answer {
            font-size: 1.2em;
            font-weight: bold;
            color: #22c55e;
        }
        
        /* Навигационные кнопки */
        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .back-btn {
            background: #6c757d;
        }
        
        .stats-btn {
            background: #17a2b8;
        }
        
        /* Информационные блоки */
        .info-bar {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .learned-words-info {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* Настройки 25 кадра */
        .subliminal-settings {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
        }

        .subliminal-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .subliminal-toggle input {
            width: 20px;
            height: 20px;
            margin: 0;
        }

        /* Счетчик посещений */
        .visit-counter {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 11px;
        }
        
        /* УЛУЧШЕННЫЕ СТИЛИ ДЛЯ 25-ГО КАДРА */
        .subliminal-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.05s ease;
            pointer-events: none;
            padding: 20px;
        }

        .subliminal-frame.visible {
            opacity: 1;
        }

        .subliminal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 90%;
            max-width: 300px;
        }

        .subliminal-combined {
            font-size: 2.5em;
            color: #4CAF50;
            text-align: center;
            line-height: 1.2;
            font-weight: 700;
        }

        .subliminal-translation {
            font-size: 1.6em;
            color: #FF9800;
            text-align: center;
            font-style: italic;
        }

        /* Анимация появления */
        @keyframes subliminalFlash {
            0% { opacity: 0; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 0; transform: scale(0.95); }
        }

        .subliminal-frame.visible .subliminal-content {
            animation: subliminalFlash 0.04s ease;
        }

        /* Медиа-запросы для мобильных */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 12px;
                margin: 10px 0;
            }
            
            .menu-btn {
                padding: 14px 12px;
                margin: 4px;
                font-size: 14px;
            }
            
            .word-text {
                font-size: 1.6em;
            }
            
            .article-display {
                font-size: 1.6em;
            }
            
            .subliminal-combined {
                font-size: 2em;
            }
            
            .subliminal-translation {
                font-size: 1.4em;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🇩🇪 Deutsch Lernspiel</h1>
        
        <div id="info" class="info-bar"></div>
        
        <div id="nameBox" class="section">
            <h2>Spieler Name</h2>
            <input type="text" id="playerName" placeholder="Dein Name">
            <button class="menu-btn" onclick="saveName()">Name speichern</button>
        </div>
        
        <div id="menu" class="section" style="display:none">
            <h2>Einstellungen</h2>
            
            <div id="learnedWordsInfo" class="learned-words-info" style="display:none">
                <strong>Gelernte Wörter: <span id="learnedCount">0</span> | Gelernte Artikel: <span id="learnedArticlesCount">0</span></strong>
            </div>
            
            <div>
                <h3>Sprache / Language:</h3>
                <div class="button-row">
                    <button class="menu-btn" id="langRu" onclick="setLang('ru')">Русский</button>
                    <button class="menu-btn" id="langTr" onclick="setLang('tr')">Türkçe</button>
                    <button class="menu-btn" id="langFa" onclick="setLang('fa')">فارسی</button>
                </div>
            </div>
            
            <div>
                <h3>Spielmodus:</h3>
                <div class="button-row">
                    <button class="menu-btn" id="modeArticle" onclick="setMode('article')">Artikel wählen</button>
                    <button class="menu-btn" id="modeDeToL1" onclick="setMode('de_to_l1')">Deutsch → Übersetzung</button>
                    <button class="menu-btn" id="modeL1ToDe" onclick="setMode('l1_to_de')">Übersetzung → Deutsch</button>
                </div>
            </div>
            
            <div>
                <h3>Wörter Filter:</h3>
                <div class="button-row">
                    <button class="menu-btn filter-btn" id="filterAll" onclick="setWordFilter('all')">Alle Wörter</button>
                    <button class="menu-btn filter-btn" id="filterUnlearned" onclick="setWordFilter('unlearned')">Noch nicht gelernt</button>
                    <button class="menu-btn filter-btn" id="filterNoArticle" onclick="setWordFilter('no_article')">Artikel nicht gelernt</button>
                    <button class="menu-btn filter-btn" id="filterNoWord" onclick="setWordFilter('no_word')">Wörter nicht gelernt</button>
                </div>
            </div>
            
            <div id="wordCountInfo"></div>
            
            <div>
                <h3>Anzahl Fragen:</h3>
                <input type="number" id="qCount" value="10" min="5" max="100">
            </div>

            <div class="subliminal-settings">
                <div class="subliminal-toggle">
                    <input type="checkbox" id="subliminalToggle" checked>
                    <span>25. Frame Technologie (Unterbewusstes Lernen)</span>
                </div>
            </div>
            
            <div id="statsBox"></div>
            
            <div class="navigation-buttons">
                <button class="menu-btn stats-btn" onclick="showStats()">📊 Meine Statistik</button>
                <!-- УБРАНА КНОПКА ГЛОБАЛЬНОЙ СТАТИСТИКИ -->
                <button class="menu-btn" onclick="startQuiz()" style="background: #FF5722;">Quiz starten! 🚀</button>
            </div>

            <div class="visit-counter">
                Besucher heute: <span id="dailyVisits">0</span> | Gesamt: <span id="totalVisits">0</span>
            </div>
        </div>
        
        <div id="quiz" class="section">
            <h2>Quiz</h2>
            <div id="question"></div>
            <div id="wordDisplay">
                <!-- ИСПРАВЛЕННОЕ ОТОБРАЖЕНИЕ - АРТИКЛЬ СЛЕВА ОТ СЛОВА -->
                <div class="word-container">
                    <div id="articleDisplay" class="article-display"></div>
                    <div id="word" class="word-text"></div>
                </div>
                <div id="correctAnswerDisplay" class="correct-answer"></div>
            </div>
            <div id="translationBox" style="font-style: italic; margin: 12px 0; font-size: 1.1em;"></div>
            <div id="answers"></div>
            
            <div class="learning-status">
                <button class="status-btn" id="wordLearnedBtn" onclick="toggleWordLearned()">
                    <span class="status-icon" id="wordLearnedIcon">□</span> 
                    <span class="status-text">Wort als gelernt markieren</span>
                </button>
                <button class="status-btn" id="articleLearnedBtn" onclick="toggleArticleLearned()">
                    <span class="status-icon" id="articleLearnedIcon">□</span> 
                    <span class="status-text">Artikel als gelernt markieren</span>
                </button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">← Zurück</button>
                <div id="progress" style="font-weight: bold; font-size: 1em; padding: 12px;">Frage <span id="currentQuestion">1</span> von <span id="totalQuestions">10</span></div>
            </div>
        </div>
        
        <div id="result" class="section">
            <h2>Ergebnis</h2>
            <div id="score" style="font-size: 1.5em; margin: 20px 0;"></div>
            
            <div id="resultStats" style="margin: 20px 0;"></div>
            
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">← Zurück zum Menü</button>
                <button class="menu-btn" onclick="restart()">Neues Spiel</button>
            </div>
        </div>

        <div id="stats" class="section" style="display:none">
            <h2>📊 Meine Statistik</h2>
            <div id="detailedStats"></div>
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">← Zurück</button>
            </div>
        </div>
        
        <!-- УБРАН БЛОК ГЛОБАЛЬНОЙ СТАТИСТИКИ -->
    </div>

    <!-- 25-Й КАДР -->
    <div id="subliminalFrame" class="subliminal-frame">
        <div class="subliminal-content">
            <div id="subliminalCombined" class="subliminal-combined"></div>
            <div id="subliminalTranslation" class="subliminal-translation"></div>
        </div>
    </div>

    <script>
// Game state
let lang = 'ru';
let mode = 'article';
let index = 0;
let score = 0;
let words = [];
let filteredWords = [];
let quizWords = [];
let playerName = '';
let playerId = '';
let wordFilter = 'all';
let learnedWords = [];
let learnedArticles = [];
let startTime = Date.now();

// Настройки 25-го кадра
let subliminalEnabled = true;
let subliminalDuration = 40;

// Глобальная статистика и посещения
let globalStats = JSON.parse(localStorage.getItem('globalStats') || '{"users": {}, "onlineUsers": {}, "visits": {"daily": 0, "total": 0, "lastVisit": ""}}');
let onlineUsers = globalStats.onlineUsers;

// СЛОВАРЬ
const wordDictionary = [
  {
    "article": "der",
    "word": "Tisch",
    "translation_ru": "стол",
    "translation_tr": "masa",
    "translation_fa": "میز"
  },
  {
    "article": "der",
    "word": "Stuhl",
    "translation_ru": "стул",
    "translation_tr": "sandalye",
    "translation_fa": "صندلی"
  },
  {
    "article": "das",
    "word": "Bett",
    "translation_ru": "кровать",
    "translation_tr": "yatak",
    "translation_fa": "تخت"
  },
  {
    "article": "das",
    "word": "Sofa",
    "translation_ru": "диван",
    "translation_tr": "kanepe",
    "translation_fa": "مبلمان"
  },
  {
    "article": "der",
    "word": "Schrank",
    "translation_ru": "шкаф",
    "translation_tr": "dolap",
    "translation_fa": "کمد"
  },
  {
    "article": "die",
    "word": "Lampe",
    "translation_ru": "лампа",
    "translation_tr": "lamba",
    "translation_fa": "لامپ"
  },
  {
    "article": "das",
    "word": "Fenster",
    "translation_ru": "окно",
    "translation_tr": "pencere",
    "translation_fa": "پنجره"
  },
  {
    "article": "die",
    "word": "Tür",
    "translation_ru": "дверь",
    "translation_tr": "kapı",
    "translation_fa": "در"
  },
  {
    "article": "der",
    "word": "Spiegel",
    "translation_ru": "зеркало",
    "translation_tr": "ayna",
    "translation_fa": "آینه"
  },
  {
    "article": "das",
    "word": "Bild",
    "translation_ru": "картина",
    "translation_tr": "resim",
    "translation_fa": "تصویر"
  },
  {
    "article": "der",
    "word": "Sessel",
    "translation_ru": "кресло",
    "translation_tr": "koltuk",
    "translation_fa": "صندلی راحتی"
  },
  {
    "article": "das",
    "word": "Regal",
    "translation_ru": "полка",
    "translation_tr": "raf",
    "translation_fa": "قفسه"
  },
  {
    "article": "der",
    "word": "Teppich",
    "translation_ru": "ковёр",
    "translation_tr": "halı",
    "translation_fa": "فرش"
  },
  {
    "article": "die",
    "word": "Vase",
    "translation_ru": "ваза",
    "translation_tr": "vazo",
    "translation_fa": "گلدان"
  },
  {
    "article": "die",
    "word": "Pflanze",
    "translation_ru": "растение",
    "translation_tr": "bitki",
    "translation_fa": "گیاه"
  },
  {
    "article": "der",
    "word": "Kühlschrank",
    "translation_ru": "холодильник",
    "translation_tr": "buzdolabı",
    "translation_fa": "یخچال"
  },
  {
    "article": "der",
    "word": "Herd",
    "translation_ru": "плита",
    "translation_tr": "ocak",
    "translation_fa": "اجاق"
  },
  {
    "article": "die",
    "word": "Mikrowelle",
    "translation_ru": "микроволновка",
    "translation_tr": "mikrodalga",
    "translation_fa": "مایکروویو"
  },
  {
    "article": "der",
    "word": "Wecker",
    "translation_ru": "будильник",
    "translation_tr": "çalar saat",
    "translation_fa": "زنگ دار"
  },
  {
    "article": "die",
    "word": "Jacke",
    "translation_ru": "куртка",
    "translation_tr": "ceket",
    "translation_fa": "ژاکت"
  },
  {
    "article": "das",
    "word": "Hemd",
    "translation_ru": "рубашка",
    "translation_tr": "gömlek",
    "translation_fa": "پیراهن"
  },
  {
    "article": "die",
    "word": "Hose",
    "translation_ru": "брюки",
    "translation_tr": "pantolon",
    "translation_fa": "شلوار"
  },
  {
    "article": "der",
    "word": "Schuh",
    "translation_ru": "ботинок",
    "translation_tr": "ayakkabı",
    "translation_fa": "کفش"
  },
  {
    "article": "die",
    "word": "Mütze",
    "translation_ru": "шапка",
    "translation_tr": "şapka",
    "translation_fa": "کلاه"
  },
  {
    "article": "der",
    "word": "Hut",
    "translation_ru": "шляпа",
    "translation_tr": "şapka",
    "translation_fa": "کلاه"
  },
  {
    "article": "das",
    "word": "Kleid",
    "translation_ru": "платье",
    "translation_tr": "elbise",
    "translation_fa": "لباس"
  },
  {
    "article": "der",
    "word": "Rock",
    "translation_ru": "юбка",
    "translation_tr": "etek",
    "translation_fa": "دامن"
  },
  {
    "article": "die",
    "word": "Tasche",
    "translation_ru": "сумка",
    "translation_tr": "çanta",
    "translation_fa": "کیف"
  },
  {
    "article": "der",
    "word": "Handschuh",
    "translation_ru": "перчатка",
    "translation_tr": "eldiven",
    "translation_fa": "دستکش"
  },
  {
    "article": "der",
    "word": "Schal",
    "translation_ru": "шарф",
    "translation_tr": "atkı",
    "translation_fa": "شال"
  },
  {
    "article": "die",
    "word": "Socke",
    "translation_ru": "носок",
    "translation_tr": "çorap",
    "translation_fa": "جوراب"
  },
  {
    "article": "der",
    "word": "Regenschirm",
    "translation_ru": "зонт",
    "translation_tr": "şemsiye",
    "translation_fa": "چتر"
  },
  {
    "article": "die",
    "word": "Brille",
    "translation_ru": "очки",
    "translation_tr": "gözlük",
    "translation_fa": "عینک"
  },
  {
    "article": "der",
    "word": "Ball",
    "translation_ru": "мяч",
    "translation_tr": "top",
    "translation_fa": "توپ"
  },
  {
    "article": "der",
    "word": "Teddybär",
    "translation_ru": "плюшевый мишка",
    "translation_tr": "oyuncak ayı",
    "translation_fa": "خرس عروسکی"
  },
  {
    "article": "das",
    "word": "Spielzeug",
    "translation_ru": "игрушка",
    "translation_tr": "oyuncak",
    "translation_fa": "اسباب بازی"
  },
  {
    "article": "das",
    "word": "Buch",
    "translation_ru": "книга",
    "translation_tr": "kitap",
    "translation_fa": "کتاب"
  },
  {
    "article": "der",
    "word": "Bleistift",
    "translation_ru": "карандаш",
    "translation_tr": "kurşun kalem",
    "translation_fa": "مداد"
  },
  {
    "article": "der",
    "word": "Stift",
    "translation_ru": "ручка",
    "translation_tr": "kalem",
    "translation_fa": "خودکار"
  },
  {
    "article": "das",
    "word": "Papier",
    "translation_ru": "бумага",
    "translation_tr": "kağıt",
    "translation_fa": "کاغذ"
  },
  {
    "article": "die",
    "word": "Schere",
    "translation_ru": "ножницы",
    "translation_tr": "makas",
    "translation_fa": "قیچی"
  },
  {
    "article": "der",
    "word": "Rucksack",
    "translation_ru": "рюкзак",
    "translation_tr": "sırt çantası",
    "translation_fa": "کوله پشتی"
  },
  {
    "article": "der",
    "word": "Radiergummi",
    "translation_ru": "ластик",
    "translation_tr": "silgi",
    "translation_fa": "پاک کن"
  },
  {
    "article": "der",
    "word": "Spitzer",
    "translation_ru": "точилка",
    "translation_tr": "kalemtraş",
    "translation_fa": "تراش"
  },
  {
    "article": "das",
    "word": "Lineal",
    "translation_ru": "линейка",
    "translation_tr": "cetvel",
    "translation_fa": "خط کش"
  },
  {
    "article": "der",
    "word": "Brief",
    "translation_ru": "письмо",
    "translation_tr": "mektup",
    "translation_fa": "نامه"
  },
  {
    "article": "der",
    "word": "Umschlag",
    "translation_ru": "конверт",
    "translation_tr": "zarf",
    "translation_fa": "پاکت"
  },
  {
    "article": "der",
    "word": "Würfel",
    "translation_ru": "кубик",
    "translation_tr": "zar",
    "translation_fa": "تاس"
  },
  {
    "article": "die",
    "word": "Gitarre",
    "translation_ru": "гитара",
    "translation_tr": "gitar",
    "translation_fa": "گیتار"
  },
  {
    "article": "die",
    "word": "Kerze",
    "translation_ru": "свеча",
    "translation_tr": "mum",
    "translation_fa": "شمع"
  },
  {
    "article": "die",
    "word": "Fahne",
    "translation_ru": "флаг",
    "translation_tr": "bayrak",
    "translation_fa": "پرچم"
  },
  {
    "article": "der",
    "word": "Kamm",
    "translation_ru": "расчёска",
    "translation_tr": "tarak",
    "translation_fa": "شانه"
  },
  {
    "article": "der",
    "word": "Teller",
    "translation_ru": "тарелка",
    "translation_tr": "tabak",
    "translation_fa": "بشقاب"
  },
  {
    "article": "das",
    "word": "Glas",
    "translation_ru": "стакан",
    "translation_tr": "bardak",
    "translation_fa": "لیوان"
  },
  {
    "article": "die",
    "word": "Tasse",
    "translation_ru": "чашка",
    "translation_tr": "fincan",
    "translation_fa": "فنجان"
  },
  {
    "article": "der",
    "word": "Löffel",
    "translation_ru": "ложка",
    "translation_tr": "kaşık",
    "translation_fa": "قاشق"
  },
  {
    "article": "die",
    "word": "Gabel",
    "translation_ru": "вилка",
    "translation_tr": "çatal",
    "translation_fa": "چنگال"
  },
  {
    "article": "das",
    "word": "Messer",
    "translation_ru": "нож",
    "translation_tr": "bıçak",
    "translation_fa": "چاقو"
  },
  {
    "article": "die",
    "word": "Flasche",
    "translation_ru": "бутылка",
    "translation_tr": "şişe",
    "translation_fa": "بطری"
  },
  {
    "article": "der",
    "word": "Topf",
    "translation_ru": "кастрюля",
    "translation_tr": "tencere",
    "translation_fa": "قابلمه"
  },
  {
    "article": "die",
    "word": "Pfanne",
    "translation_ru": "сковорода",
    "translation_tr": "tava",
    "translation_fa": "تابه"
  },
  {
    "article": "die",
    "word": "Schüssel",
    "translation_ru": "миска",
    "translation_tr": "kase",
    "translation_fa": "کاسه"
  },
  {
    "article": "der",
    "word": "Hund",
    "translation_ru": "собака",
    "translation_tr": "köpek",
    "translation_fa": "سگ"
  },
  {
    "article": "die",
    "word": "Katze",
    "translation_ru": "кошка",
    "translation_tr": "kedi",
    "translation_fa": "گربه"
  },
  {
    "article": "der",
    "word": "Vogel",
    "translation_ru": "птица",
    "translation_tr": "kuş",
    "translation_fa": "پرنده"
  },
  {
    "article": "das",
    "word": "Pferd",
    "translation_ru": "лошадь",
    "translation_tr": "at",
    "translation_fa": "اسب"
  },
  {
    "article": "die",
    "word": "Kuh",
    "translation_ru": "корова",
    "translation_tr": "inek",
    "translation_fa": "گاو"
  },
  {
    "article": "das",
    "word": "Schaf",
    "translation_ru": "овца",
    "translation_tr": "koyun",
    "translation_fa": "گوسفند"
  },
  {
    "article": "das",
    "word": "Schwein",
    "translation_ru": "свинья",
    "translation_tr": "domuz",
    "translation_fa": "خوک"
  },
  {
    "article": "der",
    "word": "Hase",
    "translation_ru": "заяц",
    "translation_tr": "tavşan",
    "translation_fa": "خرگوش"
  },
  {
    "article": "die",
    "word": "Maus",
    "translation_ru": "мышь",
    "translation_tr": "fare",
    "translation_fa": "موش"
  },
  {
    "article": "der",
    "word": "Fisch",
    "translation_ru": "рыба",
    "translation_tr": "balık",
    "translation_fa": "ماهی"
  },
  {
    "article": "der",
    "word": "Bär",
    "translation_ru": "медведь",
    "translation_tr": "ayı",
    "translation_fa": "خرس"
  },
  {
    "article": "der",
    "word": "Elefant",
    "translation_ru": "слон",
    "translation_tr": "fil",
    "translation_fa": "فیل"
  },
  {
    "article": "die",
    "word": "Giraffe",
    "translation_ru": "жираф",
    "translation_tr": "zürafa",
    "translation_fa": "زرافه"
  },
  {
    "article": "der",
    "word": "Löwe",
    "translation_ru": "лев",
    "translation_tr": "aslan",
    "translation_fa": "شیر"
  },
  {
    "article": "der",
    "word": "Frosch",
    "translation_ru": "лягушка",
    "translation_tr": "kurbağa",
    "translation_fa": "قورباغه"
  },
  {
    "article": "der",
    "word": "Schmetterling",
    "translation_ru": "бабочка",
    "translation_tr": "kelebek",
    "translation_fa": "پروانه"
  },
  {
    "article": "das",
    "word": "Auto",
    "translation_ru": "машина",
    "translation_tr": "araba",
    "translation_fa": "ماشین"
  },
  {
    "article": "der",
    "word": "Bus",
    "translation_ru": "автобус",
    "translation_tr": "otobüs",
    "translation_fa": "اتوبوس"
  },
  {
    "article": "der",
    "word": "Zug",
    "translation_ru": "поезд",
    "translation_tr": "tren",
    "translation_fa": "قطار"
  },
  {
    "article": "das",
    "word": "Fahrrad",
    "translation_ru": "велосипед",
    "translation_tr": "bisiklet",
    "translation_fa": "دوچرخه"
  },
  {
    "article": "das",
    "word": "Motorrad",
    "translation_ru": "мотоцикл",
    "translation_tr": "motosiklet",
    "translation_fa": "موتورسیکلت"
  },
  {
    "article": "das",
    "word": "Schiff",
    "translation_ru": "корабль",
    "translation_tr": "gemi",
    "translation_fa": "کشتی"
  },
  {
    "article": "das",
    "word": "Flugzeug",
    "translation_ru": "самолёт",
    "translation_tr": "uçak",
    "translation_fa": "هواپیما"
  },
  {
    "article": "das",
    "word": "Boot",
    "translation_ru": "лодка",
    "translation_tr": "tekne",
    "translation_fa": "قایق"
  },
  {
    "article": "der",
    "word": "Computer",
    "translation_ru": "компьютер",
    "translation_tr": "bilgisayar",
    "translation_fa": "کامپیوتر"
  },
  {
    "article": "das",
    "word": "Handy",
    "translation_ru": "телефон",
    "translation_tr": "cep telefonu",
    "translation_fa": "تلفن همراه"
  },
  {
    "article": "der",
    "word": "Fernseher",
    "translation_ru": "телевизор",
    "translation_tr": "televizyon",
    "translation_fa": "تلویزیون"
  },
  {
    "article": "die",
    "word": "Kamera",
    "translation_ru": "фотоаппарат",
    "translation_tr": "kamera",
    "translation_fa": "دوربین"
  },
  {
    "article": "die",
    "word": "Uhr",
    "translation_ru": "часы",
    "translation_tr": "saat",
    "translation_fa": "ساعت"
  },
  {
    "article": "der",
    "word": "Schlüssel",
    "translation_ru": "ключ",
    "translation_tr": "anahtar",
    "translation_fa": "کلید"
  },
  {
    "article": "der",
    "word": "Apfel",
    "translation_ru": "яблоко",
    "translation_tr": "elma",
    "translation_fa": "سیب"
  },
  {
    "article": "die",
    "word": "Banane",
    "translation_ru": "банан",
    "translation_tr": "muz",
    "translation_fa": "موز"
  },
  {
    "article": "die",
    "word": "Tomate",
    "translation_ru": "помидор",
    "translation_tr": "domates",
    "translation_fa": "گوجه فرنگی"
  },
  {
    "article": "die",
    "word": "Gurke",
    "translation_ru": "огурец",
    "translation_tr": "salatalık",
    "translation_fa": "خیار"
  },
  {
    "article": "das",
    "word": "Brot",
    "translation_ru": "хлеб",
    "translation_tr": "ekmek",
    "translation_fa": "نان"
  },
  {
    "article": "der",
    "word": "Kuchen",
    "translation_ru": "пирог",
    "translation_tr": "pasta",
    "translation_fa": "کیک"
  },
  {
    "article": "das",
    "word": "Eis",
    "translation_ru": "мороженое",
    "translation_tr": "dondurma",
    "translation_fa": "بستنی"
  },
  {
    "article": "die",
    "word": "Zitrone",
    "translation_ru": "лимон",
    "translation_tr": "limon",
    "translation_fa": "لیمو"
  },
  {
    "article": "die",
    "word": "Erdbeere",
    "translation_ru": "клубника",
    "translation_tr": "çilek",
    "translation_fa": "توت فرنگی"
  },
  {
    "article": "die",
    "word": "Orange",
    "translation_ru": "апельсин",
    "translation_tr": "portakal",
    "translation_fa": "پرتقال"
  }
];

// Генерация ID пользователя
function generateUserId() {
    return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
}

// Обновление счетчика посещений
function updateVisitCounter() {
    const today = new Date().toDateString();
    const lastVisit = globalStats.visits.lastVisit;
    
    if (lastVisit !== today) {
        // Новый день
        globalStats.visits.daily = 1;
        globalStats.visits.lastVisit = today;
    } else {
        // Тот же день
        globalStats.visits.daily++;
    }
    
    globalStats.visits.total++;
    saveGlobalStats();
    
    // Обновляем отображение
    document.getElementById('dailyVisits').textContent = globalStats.visits.daily;
    document.getElementById('totalVisits').textContent = globalStats.visits.total;
}

// Загрузка данных пользователя
function loadPlayerData() {
    playerName = localStorage.getItem('playerName') || '';
    playerId = localStorage.getItem('playerId') || generateUserId();
    
    if (!localStorage.getItem('playerId')) {
        localStorage.setItem('playerId', playerId);
    }
    
    if (playerName) {
        document.getElementById('playerName').value = playerName;
        document.getElementById('nameBox').style.display = 'none';
        document.getElementById('menu').style.display = 'block';
        loadWords();
        updateVisitCounter();
        updateMenuButtons(); // Обновляем подсветку кнопок
    }
    
    // Загрузка выученных слов и артиклей
    const learnedWordsData = localStorage.getItem(`learnedWords_${playerId}`);
    const learnedArticlesData = localStorage.getItem(`learnedArticles_${playerId}`);
    
    learnedWords = learnedWordsData ? JSON.parse(learnedWordsData) : [];
    learnedArticles = learnedArticlesData ? JSON.parse(learnedArticlesData) : [];
    
    updateOnlineStatus();
}

// Обновление подсветки кнопок в меню
function updateMenuButtons() {
    // Язык
    document.getElementById('langRu').classList.toggle('active', lang === 'ru');
    document.getElementById('langTr').classList.toggle('active', lang === 'tr');
    document.getElementById('langFa').classList.toggle('active', lang === 'fa');
    
    // Режим
    document.getElementById('modeArticle').classList.toggle('active', mode === 'article');
    document.getElementById('modeDeToL1').classList.toggle('active', mode === 'de_to_l1');
    document.getElementById('modeL1ToDe').classList.toggle('active', mode === 'l1_to_de');
    
    // Фильтры
    document.getElementById('filterAll').classList.toggle('active', wordFilter === 'all');
    document.getElementById('filterUnlearned').classList.toggle('active', wordFilter === 'unlearned');
    document.getElementById('filterNoArticle').classList.toggle('active', wordFilter === 'no_article');
    document.getElementById('filterNoWord').classList.toggle('active', wordFilter === 'no_word');
}

// Сохранение имени
function saveName() {
    const nameInput = document.getElementById('playerName');
    playerName = nameInput.value.trim();
    
    if (!playerName) {
        alert('Bitte geben Sie Ihren Namen ein.');
        return;
    }
    
    localStorage.setItem('playerName', playerName);
    document.getElementById('nameBox').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
    loadWords();
    updateVisitCounter();
    updateMenuButtons();
}

// Обновление онлайн статуса
function updateOnlineStatus() {
    if (playerId && playerName) {
        onlineUsers[playerId] = {
            name: playerName,
            lastSeen: Date.now(),
            sessionStart: startTime
        };
        saveGlobalStats();
    }
}

// Сохранение глобальной статистики
function saveGlobalStats() {
    const now = Date.now();
    Object.keys(onlineUsers).forEach(id => {
        if (now - onlineUsers[id].lastSeen > 5 * 60 * 1000) {
            delete onlineUsers[id];
        }
    });
    
    globalStats.onlineUsers = onlineUsers;
    localStorage.setItem('globalStats', JSON.stringify(globalStats));
}

// Загрузка слов
function loadWords() {
    try {
        words = wordDictionary.map(w => ({
            article: (w.article || 'das').toLowerCase(),
            word: w.word || '',
            german: `${(w.article || 'das').toLowerCase()} ${w.word || ''}`.trim(),
            translation_ru: w.translation_ru || '',
            translation_tr: w.translation_tr || '',
            translation_fa: w.translation_fa || '',
            id: generateWordId(w)
        })).filter(x => x.word);
        
        applyWordFilter();
        updateLearnedWordsDisplay();
        
    } catch(err) {
        console.error('Error loading words:', err);
        alert('Ошибка загрузки слов');
    }
}

function generateWordId(word) {
    return `${word.article}_${word.word}`.toLowerCase().replace(/\s+/g, '_');
}

// Фильтры
function setWordFilter(filter) {
    wordFilter = filter;
    applyWordFilter();
    updateMenuButtons(); // Обновляем подсветку
}

function applyWordFilter() {
    if (!words.length) return;
    
    switch(wordFilter) {
        case 'learned':
            filteredWords = words.filter(word => 
                learnedWords.includes(word.id) || learnedArticles.includes(word.id)
            );
            break;
        case 'unlearned':
            filteredWords = words.filter(word => 
                !learnedWords.includes(word.id) && !learnedArticles.includes(word.id)
            );
            break;
        case 'no_article':
            filteredWords = words.filter(word => 
                !learnedArticles.includes(word.id)
            );
            break;
        case 'no_word':
            filteredWords = words.filter(word => 
                !learnedWords.includes(word.id)
            );
            break;
        case 'all':
        default:
            filteredWords = [...words];
            break;
    }
    
    updateWordCountDisplay();
}

function updateWordCountDisplay() {
    const availableCount = filteredWords.length;
    const totalCount = words.length;
    const learnedWordsCount = learnedWords.length;
    const learnedArticlesCount = learnedArticles.length;
    
    const wordCountInfo = document.getElementById('wordCountInfo');
    if (wordCountInfo) {
        wordCountInfo.innerHTML = `
            Verfügbare Wörter: <b>${availableCount}</b> / ${totalCount}<br>
            Wörter gelernt: ${learnedWordsCount} | Artikel gelernt: ${learnedArticlesCount}
        `;
    }
}

function updateLearnedWordsDisplay() {
    const learnedWordsCount = learnedWords.length;
    const learnedArticlesCount = learnedArticles.length;
    const learnedInfo = document.getElementById('learnedWordsInfo');
    const learnedCountSpan = document.getElementById('learnedCount');
    const learnedArticlesSpan = document.getElementById('learnedArticlesCount');
    
    if (learnedInfo && learnedCountSpan && learnedArticlesSpan) {
        learnedCountSpan.textContent = learnedWordsCount;
        learnedArticlesSpan.textContent = learnedArticlesCount;
        if (learnedWordsCount > 0 || learnedArticlesCount > 0) {
            learnedInfo.style.display = 'block';
        } else {
            learnedInfo.style.display = 'none';
        }
    }
}

// СБРОС СТАТУСА КНОПОК ДЛЯ НОВОГО СЛОВА
function resetLearningStatusButtons() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    
    const wordBtn = document.getElementById('wordLearnedBtn');
    const wordIcon = document.getElementById('wordLearnedIcon');
    const articleBtn = document.getElementById('articleLearnedBtn');
    const articleIcon = document.getElementById('articleLearnedIcon');
    
    // Сбрасываем кнопку слова
    if (learnedWords.includes(wordId)) {
        wordBtn.classList.add('word-learned');
        wordIcon.textContent = '✅';
    } else {
        wordBtn.classList.remove('word-learned');
        wordIcon.textContent = '□';
    }
    
    // Сбрасываем кнопку артикля
    if (learnedArticles.includes(wordId)) {
        articleBtn.classList.add('article-learned');
        articleIcon.textContent = '✅';
    } else {
        articleBtn.classList.remove('article-learned');
        articleIcon.textContent = '□';
    }
}

// Управление изученными словами и артиклями
function toggleWordLearned() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    const btn = document.getElementById('wordLearnedBtn');
    const icon = document.getElementById('wordLearnedIcon');
    
    if (learnedWords.includes(wordId)) {
        learnedWords = learnedWords.filter(id => id !== wordId);
        btn.classList.remove('word-learned');
        icon.textContent = '□';
    } else {
        learnedWords.push(wordId);
        btn.classList.add('word-learned');
        icon.textContent = '✅';
    }
    
    saveLearnedData();
}

function toggleArticleLearned() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    const btn = document.getElementById('articleLearnedBtn');
    const icon = document.getElementById('articleLearnedIcon');
    
    if (learnedArticles.includes(wordId)) {
        learnedArticles = learnedArticles.filter(id => id !== wordId);
        btn.classList.remove('article-learned');
        icon.textContent = '□';
    } else {
        learnedArticles.push(wordId);
        btn.classList.add('article-learned');
        icon.textContent = '✅';
    }
    
    saveLearnedData();
}

function saveLearnedData() {
    localStorage.setItem(`learnedWords_${playerId}`, JSON.stringify(learnedWords));
    localStorage.setItem(`learnedArticles_${playerId}`, JSON.stringify(learnedArticles));
    updateLearnedWordsDisplay();
}

// Функция показа 25-го кадра
function showSubliminalFrame(word) {
    if (!subliminalEnabled) return;
    
    const frame = document.getElementById('subliminalFrame');
    const combinedEl = document.getElementById('subliminalCombined');
    const translationEl = document.getElementById('subliminalTranslation');
    
    combinedEl.textContent = `${word.article} ${word.word}`;
    translationEl.textContent = pickTranslation(word);
    
    frame.classList.add('visible');
    
    setTimeout(() => {
        frame.classList.remove('visible');
    }, subliminalDuration);
}

// Обновление статистики
function updateStats() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    stats.games++;
    stats.totalQuestions += quizWords.length;
    stats.totalCorrect += score;
    if (score > stats.bestScore) {
        stats.bestScore = score;
    }
    localStorage.setItem(`stats_${playerId}`, JSON.stringify(stats));
    
    if (playerId && playerName) {
        if (!globalStats.users) globalStats.users = {};
        globalStats.users[playerId] = {
            name: playerName,
            games: stats.games,
            bestScore: stats.bestScore,
            totalQuestions: stats.totalQuestions,
            totalCorrect: stats.totalCorrect,
            accuracy: stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0,
            learnedWords: learnedWords.length,
            learnedArticles: learnedArticles.length,
            lastActive: new Date().toLocaleDateString()
        };
        saveGlobalStats();
    }
    
    updateStatsDisplay();
}

function updateStatsDisplay() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    const accuracy = stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0;
    
    // ИСПРАВЛЕНО: убрано имя "Gadzera", используется "Ihnen"
    document.getElementById('statsBox').innerHTML = `
        <b>Statistik für Sie:</b><br>
        Spiele: ${stats.games}<br>
        Bestes Ergebnis: ${stats.bestScore}<br>
        Genauigkeit: ${accuracy}%<br>
        Gelernte Wörter: ${learnedWords.length}<br>
        Gelernte Artikel: ${learnedArticles.length}
    `;
}

// Основная логика викторины
function nextQuestion() {
    if (index >= quizWords.length) {
        finishQuiz();
        return;
    }
    
    const q = quizWords[index];
    
    // СБРАСЫВАЕМ СТАТУС КНОПОК ДЛЯ НОВОГО СЛОВА
    resetLearningStatusButtons();
    
    document.getElementById('currentQuestion').textContent = index + 1;
    document.getElementById('totalQuestions').textContent = quizWords.length;
    
    const progressPercent = ((index) / quizWords.length) * 100;
    document.getElementById('progressFill').style.width = `${progressPercent}%`;
    
    document.getElementById('articleDisplay').textContent = '';
    document.getElementById('correctAnswerDisplay').textContent = '';
    document.getElementById('translationBox').textContent = '';
    
    let qText = '';
    let opts = [];
    let correct;
    
    if (mode === 'article') {
        qText = `Welcher Artikel passt zu:`;
        document.getElementById('word').innerText = q.word;
        document.getElementById('translationBox').textContent = pickTranslation(q);
        opts = ['der', 'die', 'das'];
        correct = q.article;
    } else if (mode === 'de_to_l1') {
        const g = (q.german || ((q.article || 'das') + ' ' + q.word)).trim();
        qText = `Was bedeutet:`;
        document.getElementById('word').innerText = g;
        const correctT = pickTranslation(q);
        const pool = shuffle(words.map(w => pickTranslation(w)).filter(t => t && t !== correctT));
        opts = pool.slice(0, 3);
        opts.push(correctT);
        correct = correctT;
    } else {
        const trans = pickTranslation(q);
        qText = `Wie heißt auf Deutsch:`;
        document.getElementById('word').innerText = trans;
        const correctG = (q.german || ((q.article || 'das') + ' ' + q.word)).trim();
        const pool = shuffle(words.map(w => (w.german || ((w.article || 'das') + ' ' + w.word)).trim()).filter(g => g !== correctG));
        opts = pool.slice(0, 3);
        opts.push(correctG);
        correct = correctG;
    }
    
    opts = shuffle(opts);
    document.getElementById('question').innerText = qText;
    const ans = document.getElementById('answers');
    ans.innerHTML = '';
    
    opts.forEach(opt => {
        const b = document.createElement('button');
        b.textContent = opt;
        b.onclick = () => checkAnswer(b, opt, correct, q);
        ans.appendChild(b);
    });
}

function checkAnswer(button, selected, correct, q) {
    const allButtons = document.querySelectorAll('#answers button');
    allButtons.forEach(btn => {
        btn.onclick = null;
    });

    if (selected === correct) {
        button.style.background = 'green';
        score++;
        
        if (subliminalEnabled) {
            showSubliminalFrame(q);
        }
        
        if (mode === 'article') {
            // ИСПРАВЛЕННОЕ ОТОБРАЖЕНИЕ - АРТИКЛЬ СЛЕВА ОТ СЛОВА
            document.getElementById('articleDisplay').textContent = q.article;
            document.getElementById('articleDisplay').style.color = '#22c55e';
        } else {
            showCorrectAnswer(correct);
        }
    } else {
        button.style.background = 'red';
        allButtons.forEach(btn => {
            if (btn.textContent === correct) {
                btn.style.background = 'green';
            }
        });
        
        if (subliminalEnabled) {
            showSubliminalFrame(q);
        }
        
        if (mode === 'article') {
            // ИСПРАВЛЕННОЕ ОТОБРАЖЕНИЕ - АРТИКЛЬ СЛЕВА ОТ СЛОВА
            document.getElementById('articleDisplay').textContent = q.article;
            document.getElementById('articleDisplay').style.color = '#22c55e';
        } else {
            showCorrectAnswer(correct);
        }
    }
    
    setTimeout(() => {
        index++;
        nextQuestion();
    }, 1500);
}

function showCorrectAnswer(answer) {
    const el = document.getElementById('correctAnswerDisplay');
    el.textContent = answer;
    el.style.color = '#22c55e';
}

function pickTranslation(item) {
    if (lang === 'tr') return item.translation_tr || item.translation_ru || '';
    if (lang === 'fa') return item.translation_fa || item.translation_ru || '';
    return item.translation_ru || item.translation_tr || item.translation_fa || '';
}

function finishQuiz() {
    document.getElementById('quiz').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    const accuracy = (score / quizWords.length * 100).toFixed(1);
    document.getElementById('score').innerText = `${score} / ${quizWords.length} (${accuracy}%)`;
    
    const resultStats = document.getElementById('resultStats');
    resultStats.innerHTML = `
        <div style="margin: 15px 0;">
            <strong>Gelernte Wörter in diesem Spiel:</strong> ${learnedWords.length}<br>
            <strong>Gelernte Artikel in diesem Spiel:</strong> ${learnedArticles.length}
        </div>
    `;
    
    updateStats();
}

function showStats() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    const accuracy = stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0;
    
    document.getElementById('detailedStats').innerHTML = `
        <div style="text-align: left; line-height: 1.6;">
            <h3>📈 Detaillierte Statistik</h3>
            <p><strong>Gesamtspiele:</strong> ${stats.games}</p>
            <p><strong>Beste Punktzahl:</strong> ${stats.bestScore}</p>
            <p><strong>Gesamtfragen:</strong> ${stats.totalQuestions}</p>
            <p><strong>Richtige Antworten:</strong> ${stats.totalCorrect}</p>
            <p><strong>Genauigkeit:</strong> ${accuracy}%</p>
            <p><strong>Gelernte Wörter:</strong> ${learnedWords.length}</p>
            <p><strong>Gelernte Artikel:</strong> ${learnedArticles.length}</p>
            <p><strong>Verfügbare Wörter:</strong> ${words.length}</p>
        </div>
    `;
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('stats').style.display = 'block';
}

function backToMenu() {
    document.getElementById('quiz').style.display = 'none';
    document.getElementById('result').style.display = 'none';
    document.getElementById('stats').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
}

function restart() {
    document.getElementById('result').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
    applyWordFilter();
}

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function startSessionTimer() {
    setInterval(() => {
        document.getElementById('info').innerHTML = `<span>Sprache: ${getLanguageName(lang)}</span> • <span>Modus: ${getModeName(mode)}</span>`;
    }, 1000);
}

function getLanguageName(lang) {
    const names = {
        'ru': 'Русский',
        'tr': 'Türkçe',
        'fa': 'فارسی'
    };
    return names[lang] || 'Русский';
}

function getModeName(mode) {
    const names = {
        'article': 'Artikel wählen',
        'de_to_l1': 'Deutsch → Übersetzung',
        'l1_to_de': 'Übersetzung → Deutsch'
    };
    return names[mode] || 'Artikel wählen';
}

function setLang(language) {
    lang = language;
    updateStatsDisplay();
    updateMenuButtons(); // Обновляем подсветку
}

function setMode(gameMode) {
    mode = gameMode;
    updateStatsDisplay();
    updateMenuButtons(); // Обновляем подсветку
}

function startQuiz() {
    if (!filteredWords.length) {
        alert(`Keine Wörter verfügbar für den ausgewählten Filter (${wordFilter}). Bitte wählen Sie einen anderen Filter.`);
        return;
    }
    
    let qCount = parseInt(document.getElementById('qCount').value) || 10;
    qCount = Math.max(5, Math.min(100, qCount));
    
    const pool = shuffle([...filteredWords]);
    quizWords = pool.slice(0, Math.min(qCount, pool.length));
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('quiz').style.display = 'block';
    
    index = 0;
    score = 0;
    
    nextQuestion();
}

// Загружаем настройки 25-го кадра
function loadSubliminalSettings() {
    const saved = localStorage.getItem('subliminalEnabled');
    if (saved !== null) {
        subliminalEnabled = JSON.parse(saved);
    }
    document.getElementById('subliminalToggle').checked = subliminalEnabled;
}

// Инициализация
function init() {
    loadPlayerData();
    updateStatsDisplay();
    startSessionTimer();
    loadSubliminalSettings();
    
    document.getElementById('subliminalToggle').addEventListener('change', function(e) {
        subliminalEnabled = e.target.checked;
        localStorage.setItem('subliminalEnabled', subliminalEnabled);
    });
    
    setInterval(updateOnlineStatus, 60000);
}

window.onload = init;
    </script>

    <div style="text-align: center; padding: 15px; color: #666; font-size: 12px;">
        powered by Aleksandr Gadzera • @ale11111
    </div>

</body>
</html>
