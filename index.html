<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deutsch Lernspiel</title>
    <style>
        /* Reset –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.4;
        }
        
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            background: white; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        h2 {
            font-size: 1.2em;
            margin-bottom: 12px;
            color: #444;
        }
        
        h3 {
            font-size: 1.1em;
            margin: 12px 0 8px;
            color: #555;
        }
        
        .section { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        
        /* –ù–ï–ô–¢–†–ê–õ–¨–ù–´–ï –ö–ù–û–ü–ö–ò –í –ú–ï–ù–Æ */
        .menu-btn { 
            padding: 12px 16px; 
            margin: 6px; 
            cursor: pointer; 
            border: none;
            border-radius: 8px;
            background: #6c757d; /* –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä—ã–π */
            color: white;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        
        .menu-btn.active { 
            background: #4CAF50; /* –ó–µ–ª–µ–Ω—ã–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
        }
        
        .menu-btn:active {
            transform: scale(0.96);
        }
        
        .filter-btn { 
            background: #6c757d; 
            font-size: 13px;
            padding: 10px 14px;
        }
        
        .filter-btn.active {
            background: #2196F3;
        }
        
        input, select { 
            padding: 12px; 
            margin: 8px 0; 
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-size: 16px;
            min-height: 44px;
        }
        
        #quiz, #result { 
            display: none; 
            text-align: center; 
        }
        
        #answers button { 
            display: block; 
            width: 100%; 
            margin: 8px 0; 
            background: #666;
            font-size: 16px;
            padding: 16px;
            color: white;
        }

        /* –ö–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 10px 0;
        }

        .button-row button {
            flex: 1;
            min-width: calc(50% - 6px);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑—É—á–µ–Ω–∏—è */
        .learning-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .status-btn {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            color: #333;
            min-height: 50px;
        }
        
        .status-btn:active {
            transform: scale(0.98);
        }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .word-learned {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }
        
        .article-learned {
            border-color: #2196F3;
            background: #2196F3;
            color: white;
        }
        
        .status-icon {
            font-size: 18px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–õ–û–í–ê - –ê–†–¢–ò–ö–õ–¨ –°–õ–ï–í–ê */
        #wordDisplay {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .word-container {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .article-display {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        .word-text {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            text-align: center;
            word-break: break-word;
        }
        
        .correct-answer {
            font-size: 1.2em;
            font-weight: bold;
            color: #22c55e;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .back-btn {
            background: #6c757d;
        }
        
        .stats-btn {
            background: #17a2b8;
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ */
        .info-bar {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .learned-words-info {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ 25 –∫–∞–¥—Ä–∞ */
        .subliminal-settings {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
        }

        .subliminal-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .subliminal-toggle input {
            width: 20px;
            height: 20px;
            margin: 0;
        }

        /* –°—á–µ—Ç—á–∏–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π */
        .visit-counter {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 11px;
        }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø 25-–ì–û –ö–ê–î–†–ê */
        .subliminal-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.05s ease;
            pointer-events: none;
            padding: 20px;
        }

        .subliminal-frame.visible {
            opacity: 1;
        }

        .subliminal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 90%;
            max-width: 300px;
        }

        .subliminal-combined {
            font-size: 2.5em;
            color: #4CAF50;
            text-align: center;
            line-height: 1.2;
            font-weight: 700;
        }

        .subliminal-translation {
            font-size: 1.6em;
            color: #FF9800;
            text-align: center;
            font-style: italic;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes subliminalFlash {
            0% { opacity: 0; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 0; transform: scale(0.95); }
        }

        .subliminal-frame.visible .subliminal-content {
            animation: subliminalFlash 0.04s ease;
        }

        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 12px;
                margin: 10px 0;
            }
            
            .menu-btn {
                padding: 14px 12px;
                margin: 4px;
                font-size: 14px;
            }
            
            .word-text {
                font-size: 1.6em;
            }
            
            .article-display {
                font-size: 1.6em;
            }
            
            .subliminal-combined {
                font-size: 2em;
            }
            
            .subliminal-translation {
                font-size: 1.4em;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üá©üá™ Deutsch Lernspiel</h1>
        
        <div id="info" class="info-bar"></div>
        
        <div id="nameBox" class="section">
            <h2>Spieler Name</h2>
            <input type="text" id="playerName" placeholder="Dein Name">
            <button class="menu-btn" onclick="saveName()">Name speichern</button>
        </div>
        
        <div id="menu" class="section" style="display:none">
            <h2>Einstellungen</h2>
            
            <div id="learnedWordsInfo" class="learned-words-info" style="display:none">
                <strong>Gelernte W√∂rter: <span id="learnedCount">0</span> | Gelernte Artikel: <span id="learnedArticlesCount">0</span></strong>
            </div>
            
            <div>
                <h3>Sprache / Language:</h3>
                <div class="button-row">
                    <button class="menu-btn" id="langRu" onclick="setLang('ru')">–†—É—Å—Å–∫–∏–π</button>
                    <button class="menu-btn" id="langTr" onclick="setLang('tr')">T√ºrk√ße</button>
                    <button class="menu-btn" id="langFa" onclick="setLang('fa')">ŸÅÿßÿ±ÿ≥€å</button>
                </div>
            </div>
            
            <div>
                <h3>Spielmodus:</h3>
                <div class="button-row">
                    <button class="menu-btn" id="modeArticle" onclick="setMode('article')">Artikel w√§hlen</button>
                    <button class="menu-btn" id="modeDeToL1" onclick="setMode('de_to_l1')">Deutsch ‚Üí √úbersetzung</button>
                    <button class="menu-btn" id="modeL1ToDe" onclick="setMode('l1_to_de')">√úbersetzung ‚Üí Deutsch</button>
                </div>
            </div>
            
            <div>
                <h3>W√∂rter Filter:</h3>
                <div class="button-row">
                    <button class="menu-btn filter-btn" id="filterAll" onclick="setWordFilter('all')">Alle W√∂rter</button>
                    <button class="menu-btn filter-btn" id="filterUnlearned" onclick="setWordFilter('unlearned')">Noch nicht gelernt</button>
                    <button class="menu-btn filter-btn" id="filterNoArticle" onclick="setWordFilter('no_article')">Artikel nicht gelernt</button>
                    <button class="menu-btn filter-btn" id="filterNoWord" onclick="setWordFilter('no_word')">W√∂rter nicht gelernt</button>
                </div>
            </div>
            
            <div id="wordCountInfo"></div>
            
            <div>
                <h3>Anzahl Fragen:</h3>
                <input type="number" id="qCount" value="10" min="5" max="100">
            </div>

            <div class="subliminal-settings">
                <div class="subliminal-toggle">
                    <input type="checkbox" id="subliminalToggle" checked>
                    <span>25. Frame Technologie (Unterbewusstes Lernen)</span>
                </div>
            </div>
            
            <div id="statsBox"></div>
            
            <div class="navigation-buttons">
                <button class="menu-btn stats-btn" onclick="showStats()">üìä Meine Statistik</button>
                <!-- –£–ë–†–ê–ù–ê –ö–ù–û–ü–ö–ê –ì–õ–û–ë–ê–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
                <button class="menu-btn" onclick="startQuiz()" style="background: #FF5722;">Quiz starten! üöÄ</button>
            </div>

            <div class="visit-counter">
                Besucher heute: <span id="dailyVisits">0</span> | Gesamt: <span id="totalVisits">0</span>
            </div>
        </div>
        
        <div id="quiz" class="section">
            <h2>Quiz</h2>
            <div id="question"></div>
            <div id="wordDisplay">
                <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï - –ê–†–¢–ò–ö–õ–¨ –°–õ–ï–í–ê –û–¢ –°–õ–û–í–ê -->
                <div class="word-container">
                    <div id="articleDisplay" class="article-display"></div>
                    <div id="word" class="word-text"></div>
                </div>
                <div id="correctAnswerDisplay" class="correct-answer"></div>
            </div>
            <div id="translationBox" style="font-style: italic; margin: 12px 0; font-size: 1.1em;"></div>
            <div id="answers"></div>
            
            <div class="learning-status">
                <button class="status-btn" id="wordLearnedBtn" onclick="toggleWordLearned()">
                    <span class="status-icon" id="wordLearnedIcon">‚ñ°</span> 
                    <span class="status-text">Wort als gelernt markieren</span>
                </button>
                <button class="status-btn" id="articleLearnedBtn" onclick="toggleArticleLearned()">
                    <span class="status-icon" id="articleLearnedIcon">‚ñ°</span> 
                    <span class="status-text">Artikel als gelernt markieren</span>
                </button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">‚Üê Zur√ºck</button>
                <div id="progress" style="font-weight: bold; font-size: 1em; padding: 12px;">Frage <span id="currentQuestion">1</span> von <span id="totalQuestions">10</span></div>
            </div>
        </div>
        
        <div id="result" class="section">
            <h2>Ergebnis</h2>
            <div id="score" style="font-size: 1.5em; margin: 20px 0;"></div>
            
            <div id="resultStats" style="margin: 20px 0;"></div>
            
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">‚Üê Zur√ºck zum Men√º</button>
                <button class="menu-btn" onclick="restart()">Neues Spiel</button>
            </div>
        </div>

        <div id="stats" class="section" style="display:none">
            <h2>üìä Meine Statistik</h2>
            <div id="detailedStats"></div>
            <div class="navigation-buttons">
                <button class="menu-btn back-btn" onclick="backToMenu()">‚Üê Zur√ºck</button>
            </div>
        </div>
        
        <!-- –£–ë–†–ê–ù –ë–õ–û–ö –ì–õ–û–ë–ê–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
    </div>

    <!-- 25-–ô –ö–ê–î–† -->
    <div id="subliminalFrame" class="subliminal-frame">
        <div class="subliminal-content">
            <div id="subliminalCombined" class="subliminal-combined"></div>
            <div id="subliminalTranslation" class="subliminal-translation"></div>
        </div>
    </div>

    <script>
// Game state
let lang = 'ru';
let mode = 'article';
let index = 0;
let score = 0;
let words = [];
let filteredWords = [];
let quizWords = [];
let playerName = '';
let playerId = '';
let wordFilter = 'all';
let learnedWords = [];
let learnedArticles = [];
let startTime = Date.now();

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ 25-–≥–æ –∫–∞–¥—Ä–∞
let subliminalEnabled = true;
let subliminalDuration = 40;

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø–æ—Å–µ—â–µ–Ω–∏—è
let globalStats = JSON.parse(localStorage.getItem('globalStats') || '{"users": {}, "onlineUsers": {}, "visits": {"daily": 0, "total": 0, "lastVisit": ""}}');
let onlineUsers = globalStats.onlineUsers;

// –°–õ–û–í–ê–†–¨
const wordDictionary = [
  {
    "article": "der",
    "word": "Tisch",
    "translation_ru": "—Å—Ç–æ–ª",
    "translation_tr": "masa",
    "translation_fa": "ŸÖ€åÿ≤"
  },
  {
    "article": "der",
    "word": "Stuhl",
    "translation_ru": "—Å—Ç—É–ª",
    "translation_tr": "sandalye",
    "translation_fa": "ÿµŸÜÿØŸÑ€å"
  },
  {
    "article": "das",
    "word": "Bett",
    "translation_ru": "–∫—Ä–æ–≤–∞—Ç—å",
    "translation_tr": "yatak",
    "translation_fa": "ÿ™ÿÆÿ™"
  },
  {
    "article": "das",
    "word": "Sofa",
    "translation_ru": "–¥–∏–≤–∞–Ω",
    "translation_tr": "kanepe",
    "translation_fa": "ŸÖÿ®ŸÑŸÖÿßŸÜ"
  },
  {
    "article": "der",
    "word": "Schrank",
    "translation_ru": "—à–∫–∞—Ñ",
    "translation_tr": "dolap",
    "translation_fa": "⁄©ŸÖÿØ"
  },
  {
    "article": "die",
    "word": "Lampe",
    "translation_ru": "–ª–∞–º–ø–∞",
    "translation_tr": "lamba",
    "translation_fa": "ŸÑÿßŸÖŸæ"
  },
  {
    "article": "das",
    "word": "Fenster",
    "translation_ru": "–æ–∫–Ω–æ",
    "translation_tr": "pencere",
    "translation_fa": "ŸæŸÜÿ¨ÿ±Ÿá"
  },
  {
    "article": "die",
    "word": "T√ºr",
    "translation_ru": "–¥–≤–µ—Ä—å",
    "translation_tr": "kapƒ±",
    "translation_fa": "ÿØÿ±"
  },
  {
    "article": "der",
    "word": "Spiegel",
    "translation_ru": "–∑–µ—Ä–∫–∞–ª–æ",
    "translation_tr": "ayna",
    "translation_fa": "ÿ¢€åŸÜŸá"
  },
  {
    "article": "das",
    "word": "Bild",
    "translation_ru": "–∫–∞—Ä—Ç–∏–Ω–∞",
    "translation_tr": "resim",
    "translation_fa": "ÿ™ÿµŸà€åÿ±"
  },
  {
    "article": "der",
    "word": "Sessel",
    "translation_ru": "–∫—Ä–µ—Å–ª–æ",
    "translation_tr": "koltuk",
    "translation_fa": "ÿµŸÜÿØŸÑ€å ÿ±ÿßÿ≠ÿ™€å"
  },
  {
    "article": "das",
    "word": "Regal",
    "translation_ru": "–ø–æ–ª–∫–∞",
    "translation_tr": "raf",
    "translation_fa": "ŸÇŸÅÿ≥Ÿá"
  },
  {
    "article": "der",
    "word": "Teppich",
    "translation_ru": "–∫–æ–≤—ë—Ä",
    "translation_tr": "halƒ±",
    "translation_fa": "ŸÅÿ±ÿ¥"
  },
  {
    "article": "die",
    "word": "Vase",
    "translation_ru": "–≤–∞–∑–∞",
    "translation_tr": "vazo",
    "translation_fa": "⁄ØŸÑÿØÿßŸÜ"
  },
  {
    "article": "die",
    "word": "Pflanze",
    "translation_ru": "—Ä–∞—Å—Ç–µ–Ω–∏–µ",
    "translation_tr": "bitki",
    "translation_fa": "⁄Ø€åÿßŸá"
  },
  {
    "article": "der",
    "word": "K√ºhlschrank",
    "translation_ru": "—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫",
    "translation_tr": "buzdolabƒ±",
    "translation_fa": "€åÿÆ⁄ÜÿßŸÑ"
  },
  {
    "article": "der",
    "word": "Herd",
    "translation_ru": "–ø–ª–∏—Ç–∞",
    "translation_tr": "ocak",
    "translation_fa": "ÿßÿ¨ÿßŸÇ"
  },
  {
    "article": "die",
    "word": "Mikrowelle",
    "translation_ru": "–º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞",
    "translation_tr": "mikrodalga",
    "translation_fa": "ŸÖÿß€å⁄©ÿ±ŸàŸà€åŸà"
  },
  {
    "article": "der",
    "word": "Wecker",
    "translation_ru": "–±—É–¥–∏–ª—å–Ω–∏–∫",
    "translation_tr": "√ßalar saat",
    "translation_fa": "ÿ≤ŸÜ⁄Ø ÿØÿßÿ±"
  },
  {
    "article": "die",
    "word": "Jacke",
    "translation_ru": "–∫—É—Ä—Ç–∫–∞",
    "translation_tr": "ceket",
    "translation_fa": "⁄òÿß⁄©ÿ™"
  },
  {
    "article": "das",
    "word": "Hemd",
    "translation_ru": "—Ä—É–±–∞—à–∫–∞",
    "translation_tr": "g√∂mlek",
    "translation_fa": "Ÿæ€åÿ±ÿßŸáŸÜ"
  },
  {
    "article": "die",
    "word": "Hose",
    "translation_ru": "–±—Ä—é–∫–∏",
    "translation_tr": "pantolon",
    "translation_fa": "ÿ¥ŸÑŸàÿßÿ±"
  },
  {
    "article": "der",
    "word": "Schuh",
    "translation_ru": "–±–æ—Ç–∏–Ω–æ–∫",
    "translation_tr": "ayakkabƒ±",
    "translation_fa": "⁄©ŸÅÿ¥"
  },
  {
    "article": "die",
    "word": "M√ºtze",
    "translation_ru": "—à–∞–ø–∫–∞",
    "translation_tr": "≈üapka",
    "translation_fa": "⁄©ŸÑÿßŸá"
  },
  {
    "article": "der",
    "word": "Hut",
    "translation_ru": "—à–ª—è–ø–∞",
    "translation_tr": "≈üapka",
    "translation_fa": "⁄©ŸÑÿßŸá"
  },
  {
    "article": "das",
    "word": "Kleid",
    "translation_ru": "–ø–ª–∞—Ç—å–µ",
    "translation_tr": "elbise",
    "translation_fa": "ŸÑÿ®ÿßÿ≥"
  },
  {
    "article": "der",
    "word": "Rock",
    "translation_ru": "—é–±–∫–∞",
    "translation_tr": "etek",
    "translation_fa": "ÿØÿßŸÖŸÜ"
  },
  {
    "article": "die",
    "word": "Tasche",
    "translation_ru": "—Å—É–º–∫–∞",
    "translation_tr": "√ßanta",
    "translation_fa": "⁄©€åŸÅ"
  },
  {
    "article": "der",
    "word": "Handschuh",
    "translation_ru": "–ø–µ—Ä—á–∞—Ç–∫–∞",
    "translation_tr": "eldiven",
    "translation_fa": "ÿØÿ≥ÿ™⁄©ÿ¥"
  },
  {
    "article": "der",
    "word": "Schal",
    "translation_ru": "—à–∞—Ä—Ñ",
    "translation_tr": "atkƒ±",
    "translation_fa": "ÿ¥ÿßŸÑ"
  },
  {
    "article": "die",
    "word": "Socke",
    "translation_ru": "–Ω–æ—Å–æ–∫",
    "translation_tr": "√ßorap",
    "translation_fa": "ÿ¨Ÿàÿ±ÿßÿ®"
  },
  {
    "article": "der",
    "word": "Regenschirm",
    "translation_ru": "–∑–æ–Ω—Ç",
    "translation_tr": "≈üemsiye",
    "translation_fa": "⁄Üÿ™ÿ±"
  },
  {
    "article": "die",
    "word": "Brille",
    "translation_ru": "–æ—á–∫–∏",
    "translation_tr": "g√∂zl√ºk",
    "translation_fa": "ÿπ€åŸÜ⁄©"
  },
  {
    "article": "der",
    "word": "Ball",
    "translation_ru": "–º—è—á",
    "translation_tr": "top",
    "translation_fa": "ÿ™ŸàŸæ"
  },
  {
    "article": "der",
    "word": "Teddyb√§r",
    "translation_ru": "–ø–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞",
    "translation_tr": "oyuncak ayƒ±",
    "translation_fa": "ÿÆÿ±ÿ≥ ÿπÿ±Ÿàÿ≥⁄©€å"
  },
  {
    "article": "das",
    "word": "Spielzeug",
    "translation_ru": "–∏–≥—Ä—É—à–∫–∞",
    "translation_tr": "oyuncak",
    "translation_fa": "ÿßÿ≥ÿ®ÿßÿ® ÿ®ÿßÿ≤€å"
  },
  {
    "article": "das",
    "word": "Buch",
    "translation_ru": "–∫–Ω–∏–≥–∞",
    "translation_tr": "kitap",
    "translation_fa": "⁄©ÿ™ÿßÿ®"
  },
  {
    "article": "der",
    "word": "Bleistift",
    "translation_ru": "–∫–∞—Ä–∞–Ω–¥–∞—à",
    "translation_tr": "kur≈üun kalem",
    "translation_fa": "ŸÖÿØÿßÿØ"
  },
  {
    "article": "der",
    "word": "Stift",
    "translation_ru": "—Ä—É—á–∫–∞",
    "translation_tr": "kalem",
    "translation_fa": "ÿÆŸàÿØ⁄©ÿßÿ±"
  },
  {
    "article": "das",
    "word": "Papier",
    "translation_ru": "–±—É–º–∞–≥–∞",
    "translation_tr": "kaƒüƒ±t",
    "translation_fa": "⁄©ÿßÿ∫ÿ∞"
  },
  {
    "article": "die",
    "word": "Schere",
    "translation_ru": "–Ω–æ–∂–Ω–∏—Ü—ã",
    "translation_tr": "makas",
    "translation_fa": "ŸÇ€å⁄Ü€å"
  },
  {
    "article": "der",
    "word": "Rucksack",
    "translation_ru": "—Ä—é–∫–∑–∞–∫",
    "translation_tr": "sƒ±rt √ßantasƒ±",
    "translation_fa": "⁄©ŸàŸÑŸá Ÿæÿ¥ÿ™€å"
  },
  {
    "article": "der",
    "word": "Radiergummi",
    "translation_ru": "–ª–∞—Å—Ç–∏–∫",
    "translation_tr": "silgi",
    "translation_fa": "Ÿæÿß⁄© ⁄©ŸÜ"
  },
  {
    "article": "der",
    "word": "Spitzer",
    "translation_ru": "—Ç–æ—á–∏–ª–∫–∞",
    "translation_tr": "kalemtra≈ü",
    "translation_fa": "ÿ™ÿ±ÿßÿ¥"
  },
  {
    "article": "das",
    "word": "Lineal",
    "translation_ru": "–ª–∏–Ω–µ–π–∫–∞",
    "translation_tr": "cetvel",
    "translation_fa": "ÿÆÿ∑ ⁄©ÿ¥"
  },
  {
    "article": "der",
    "word": "Brief",
    "translation_ru": "–ø–∏—Å—å–º–æ",
    "translation_tr": "mektup",
    "translation_fa": "ŸÜÿßŸÖŸá"
  },
  {
    "article": "der",
    "word": "Umschlag",
    "translation_ru": "–∫–æ–Ω–≤–µ—Ä—Ç",
    "translation_tr": "zarf",
    "translation_fa": "Ÿæÿß⁄©ÿ™"
  },
  {
    "article": "der",
    "word": "W√ºrfel",
    "translation_ru": "–∫—É–±–∏–∫",
    "translation_tr": "zar",
    "translation_fa": "ÿ™ÿßÿ≥"
  },
  {
    "article": "die",
    "word": "Gitarre",
    "translation_ru": "–≥–∏—Ç–∞—Ä–∞",
    "translation_tr": "gitar",
    "translation_fa": "⁄Ø€åÿ™ÿßÿ±"
  },
  {
    "article": "die",
    "word": "Kerze",
    "translation_ru": "—Å–≤–µ—á–∞",
    "translation_tr": "mum",
    "translation_fa": "ÿ¥ŸÖÿπ"
  },
  {
    "article": "die",
    "word": "Fahne",
    "translation_ru": "—Ñ–ª–∞–≥",
    "translation_tr": "bayrak",
    "translation_fa": "Ÿæÿ±⁄ÜŸÖ"
  },
  {
    "article": "der",
    "word": "Kamm",
    "translation_ru": "—Ä–∞—Å—á—ë—Å–∫–∞",
    "translation_tr": "tarak",
    "translation_fa": "ÿ¥ÿßŸÜŸá"
  },
  {
    "article": "der",
    "word": "Teller",
    "translation_ru": "—Ç–∞—Ä–µ–ª–∫–∞",
    "translation_tr": "tabak",
    "translation_fa": "ÿ®ÿ¥ŸÇÿßÿ®"
  },
  {
    "article": "das",
    "word": "Glas",
    "translation_ru": "—Å—Ç–∞–∫–∞–Ω",
    "translation_tr": "bardak",
    "translation_fa": "ŸÑ€åŸàÿßŸÜ"
  },
  {
    "article": "die",
    "word": "Tasse",
    "translation_ru": "—á–∞—à–∫–∞",
    "translation_tr": "fincan",
    "translation_fa": "ŸÅŸÜÿ¨ÿßŸÜ"
  },
  {
    "article": "der",
    "word": "L√∂ffel",
    "translation_ru": "–ª–æ–∂–∫–∞",
    "translation_tr": "ka≈üƒ±k",
    "translation_fa": "ŸÇÿßÿ¥ŸÇ"
  },
  {
    "article": "die",
    "word": "Gabel",
    "translation_ru": "–≤–∏–ª–∫–∞",
    "translation_tr": "√ßatal",
    "translation_fa": "⁄ÜŸÜ⁄ØÿßŸÑ"
  },
  {
    "article": "das",
    "word": "Messer",
    "translation_ru": "–Ω–æ–∂",
    "translation_tr": "bƒ±√ßak",
    "translation_fa": "⁄ÜÿßŸÇŸà"
  },
  {
    "article": "die",
    "word": "Flasche",
    "translation_ru": "–±—É—Ç—ã–ª–∫–∞",
    "translation_tr": "≈üi≈üe",
    "translation_fa": "ÿ®ÿ∑ÿ±€å"
  },
  {
    "article": "der",
    "word": "Topf",
    "translation_ru": "–∫–∞—Å—Ç—Ä—é–ª—è",
    "translation_tr": "tencere",
    "translation_fa": "ŸÇÿßÿ®ŸÑŸÖŸá"
  },
  {
    "article": "die",
    "word": "Pfanne",
    "translation_ru": "—Å–∫–æ–≤–æ—Ä–æ–¥–∞",
    "translation_tr": "tava",
    "translation_fa": "ÿ™ÿßÿ®Ÿá"
  },
  {
    "article": "die",
    "word": "Sch√ºssel",
    "translation_ru": "–º–∏—Å–∫–∞",
    "translation_tr": "kase",
    "translation_fa": "⁄©ÿßÿ≥Ÿá"
  },
  {
    "article": "der",
    "word": "Hund",
    "translation_ru": "—Å–æ–±–∞–∫–∞",
    "translation_tr": "k√∂pek",
    "translation_fa": "ÿ≥⁄Ø"
  },
  {
    "article": "die",
    "word": "Katze",
    "translation_ru": "–∫–æ—à–∫–∞",
    "translation_tr": "kedi",
    "translation_fa": "⁄Øÿ±ÿ®Ÿá"
  },
  {
    "article": "der",
    "word": "Vogel",
    "translation_ru": "–ø—Ç–∏—Ü–∞",
    "translation_tr": "ku≈ü",
    "translation_fa": "Ÿæÿ±ŸÜÿØŸá"
  },
  {
    "article": "das",
    "word": "Pferd",
    "translation_ru": "–ª–æ—à–∞–¥—å",
    "translation_tr": "at",
    "translation_fa": "ÿßÿ≥ÿ®"
  },
  {
    "article": "die",
    "word": "Kuh",
    "translation_ru": "–∫–æ—Ä–æ–≤–∞",
    "translation_tr": "inek",
    "translation_fa": "⁄ØÿßŸà"
  },
  {
    "article": "das",
    "word": "Schaf",
    "translation_ru": "–æ–≤—Ü–∞",
    "translation_tr": "koyun",
    "translation_fa": "⁄ØŸàÿ≥ŸÅŸÜÿØ"
  },
  {
    "article": "das",
    "word": "Schwein",
    "translation_ru": "—Å–≤–∏–Ω—å—è",
    "translation_tr": "domuz",
    "translation_fa": "ÿÆŸà⁄©"
  },
  {
    "article": "der",
    "word": "Hase",
    "translation_ru": "–∑–∞—è—Ü",
    "translation_tr": "tav≈üan",
    "translation_fa": "ÿÆÿ±⁄ØŸàÿ¥"
  },
  {
    "article": "die",
    "word": "Maus",
    "translation_ru": "–º—ã—à—å",
    "translation_tr": "fare",
    "translation_fa": "ŸÖŸàÿ¥"
  },
  {
    "article": "der",
    "word": "Fisch",
    "translation_ru": "—Ä—ã–±–∞",
    "translation_tr": "balƒ±k",
    "translation_fa": "ŸÖÿßŸá€å"
  },
  {
    "article": "der",
    "word": "B√§r",
    "translation_ru": "–º–µ–¥–≤–µ–¥—å",
    "translation_tr": "ayƒ±",
    "translation_fa": "ÿÆÿ±ÿ≥"
  },
  {
    "article": "der",
    "word": "Elefant",
    "translation_ru": "—Å–ª–æ–Ω",
    "translation_tr": "fil",
    "translation_fa": "ŸÅ€åŸÑ"
  },
  {
    "article": "die",
    "word": "Giraffe",
    "translation_ru": "–∂–∏—Ä–∞—Ñ",
    "translation_tr": "z√ºrafa",
    "translation_fa": "ÿ≤ÿ±ÿßŸÅŸá"
  },
  {
    "article": "der",
    "word": "L√∂we",
    "translation_ru": "–ª–µ–≤",
    "translation_tr": "aslan",
    "translation_fa": "ÿ¥€åÿ±"
  },
  {
    "article": "der",
    "word": "Frosch",
    "translation_ru": "–ª—è–≥—É—à–∫–∞",
    "translation_tr": "kurbaƒüa",
    "translation_fa": "ŸÇŸàÿ±ÿ®ÿßÿ∫Ÿá"
  },
  {
    "article": "der",
    "word": "Schmetterling",
    "translation_ru": "–±–∞–±–æ—á–∫–∞",
    "translation_tr": "kelebek",
    "translation_fa": "Ÿæÿ±ŸàÿßŸÜŸá"
  },
  {
    "article": "das",
    "word": "Auto",
    "translation_ru": "–º–∞—à–∏–Ω–∞",
    "translation_tr": "araba",
    "translation_fa": "ŸÖÿßÿ¥€åŸÜ"
  },
  {
    "article": "der",
    "word": "Bus",
    "translation_ru": "–∞–≤—Ç–æ–±—É—Å",
    "translation_tr": "otob√ºs",
    "translation_fa": "ÿßÿ™Ÿàÿ®Ÿàÿ≥"
  },
  {
    "article": "der",
    "word": "Zug",
    "translation_ru": "–ø–æ–µ–∑–¥",
    "translation_tr": "tren",
    "translation_fa": "ŸÇÿ∑ÿßÿ±"
  },
  {
    "article": "das",
    "word": "Fahrrad",
    "translation_ru": "–≤–µ–ª–æ—Å–∏–ø–µ–¥",
    "translation_tr": "bisiklet",
    "translation_fa": "ÿØŸà⁄Üÿ±ÿÆŸá"
  },
  {
    "article": "das",
    "word": "Motorrad",
    "translation_ru": "–º–æ—Ç–æ—Ü–∏–∫–ª",
    "translation_tr": "motosiklet",
    "translation_fa": "ŸÖŸàÿ™Ÿàÿ±ÿ≥€å⁄©ŸÑÿ™"
  },
  {
    "article": "das",
    "word": "Schiff",
    "translation_ru": "–∫–æ—Ä–∞–±–ª—å",
    "translation_tr": "gemi",
    "translation_fa": "⁄©ÿ¥ÿ™€å"
  },
  {
    "article": "das",
    "word": "Flugzeug",
    "translation_ru": "—Å–∞–º–æ–ª—ë—Ç",
    "translation_tr": "u√ßak",
    "translation_fa": "ŸáŸàÿßŸæ€åŸÖÿß"
  },
  {
    "article": "das",
    "word": "Boot",
    "translation_ru": "–ª–æ–¥–∫–∞",
    "translation_tr": "tekne",
    "translation_fa": "ŸÇÿß€åŸÇ"
  },
  {
    "article": "der",
    "word": "Computer",
    "translation_ru": "–∫–æ–º–ø—å—é—Ç–µ—Ä",
    "translation_tr": "bilgisayar",
    "translation_fa": "⁄©ÿßŸÖŸæ€åŸàÿ™ÿ±"
  },
  {
    "article": "das",
    "word": "Handy",
    "translation_ru": "—Ç–µ–ª–µ—Ñ–æ–Ω",
    "translation_tr": "cep telefonu",
    "translation_fa": "ÿ™ŸÑŸÅŸÜ ŸáŸÖÿ±ÿßŸá"
  },
  {
    "article": "der",
    "word": "Fernseher",
    "translation_ru": "—Ç–µ–ª–µ–≤–∏–∑–æ—Ä",
    "translation_tr": "televizyon",
    "translation_fa": "ÿ™ŸÑŸà€åÿ≤€åŸàŸÜ"
  },
  {
    "article": "die",
    "word": "Kamera",
    "translation_ru": "—Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç",
    "translation_tr": "kamera",
    "translation_fa": "ÿØŸàÿ±ÿ®€åŸÜ"
  },
  {
    "article": "die",
    "word": "Uhr",
    "translation_ru": "—á–∞—Å—ã",
    "translation_tr": "saat",
    "translation_fa": "ÿ≥ÿßÿπÿ™"
  },
  {
    "article": "der",
    "word": "Schl√ºssel",
    "translation_ru": "–∫–ª—é—á",
    "translation_tr": "anahtar",
    "translation_fa": "⁄©ŸÑ€åÿØ"
  },
  {
    "article": "der",
    "word": "Apfel",
    "translation_ru": "—è–±–ª–æ–∫–æ",
    "translation_tr": "elma",
    "translation_fa": "ÿ≥€åÿ®"
  },
  {
    "article": "die",
    "word": "Banane",
    "translation_ru": "–±–∞–Ω–∞–Ω",
    "translation_tr": "muz",
    "translation_fa": "ŸÖŸàÿ≤"
  },
  {
    "article": "die",
    "word": "Tomate",
    "translation_ru": "–ø–æ–º–∏–¥–æ—Ä",
    "translation_tr": "domates",
    "translation_fa": "⁄ØŸàÿ¨Ÿá ŸÅÿ±ŸÜ⁄Ø€å"
  },
  {
    "article": "die",
    "word": "Gurke",
    "translation_ru": "–æ–≥—É—Ä–µ—Ü",
    "translation_tr": "salatalƒ±k",
    "translation_fa": "ÿÆ€åÿßÿ±"
  },
  {
    "article": "das",
    "word": "Brot",
    "translation_ru": "—Ö–ª–µ–±",
    "translation_tr": "ekmek",
    "translation_fa": "ŸÜÿßŸÜ"
  },
  {
    "article": "der",
    "word": "Kuchen",
    "translation_ru": "–ø–∏—Ä–æ–≥",
    "translation_tr": "pasta",
    "translation_fa": "⁄©€å⁄©"
  },
  {
    "article": "das",
    "word": "Eis",
    "translation_ru": "–º–æ—Ä–æ–∂–µ–Ω–æ–µ",
    "translation_tr": "dondurma",
    "translation_fa": "ÿ®ÿ≥ÿ™ŸÜ€å"
  },
  {
    "article": "die",
    "word": "Zitrone",
    "translation_ru": "–ª–∏–º–æ–Ω",
    "translation_tr": "limon",
    "translation_fa": "ŸÑ€åŸÖŸà"
  },
  {
    "article": "die",
    "word": "Erdbeere",
    "translation_ru": "–∫–ª—É–±–Ω–∏–∫–∞",
    "translation_tr": "√ßilek",
    "translation_fa": "ÿ™Ÿàÿ™ ŸÅÿ±ŸÜ⁄Ø€å"
  },
  {
    "article": "die",
    "word": "Orange",
    "translation_ru": "–∞–ø–µ–ª—å—Å–∏–Ω",
    "translation_tr": "portakal",
    "translation_fa": "Ÿæÿ±ÿ™ŸÇÿßŸÑ"
  }
];

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function generateUserId() {
    return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π
function updateVisitCounter() {
    const today = new Date().toDateString();
    const lastVisit = globalStats.visits.lastVisit;
    
    if (lastVisit !== today) {
        // –ù–æ–≤—ã–π –¥–µ–Ω—å
        globalStats.visits.daily = 1;
        globalStats.visits.lastVisit = today;
    } else {
        // –¢–æ—Ç –∂–µ –¥–µ–Ω—å
        globalStats.visits.daily++;
    }
    
    globalStats.visits.total++;
    saveGlobalStats();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.getElementById('dailyVisits').textContent = globalStats.visits.daily;
    document.getElementById('totalVisits').textContent = globalStats.visits.total;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function loadPlayerData() {
    playerName = localStorage.getItem('playerName') || '';
    playerId = localStorage.getItem('playerId') || generateUserId();
    
    if (!localStorage.getItem('playerId')) {
        localStorage.setItem('playerId', playerId);
    }
    
    if (playerName) {
        document.getElementById('playerName').value = playerName;
        document.getElementById('nameBox').style.display = 'none';
        document.getElementById('menu').style.display = 'block';
        loadWords();
        updateVisitCounter();
        updateMenuButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∫–Ω–æ–ø–æ–∫
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –∏ –∞—Ä—Ç–∏–∫–ª–µ–π
    const learnedWordsData = localStorage.getItem(`learnedWords_${playerId}`);
    const learnedArticlesData = localStorage.getItem(`learnedArticles_${playerId}`);
    
    learnedWords = learnedWordsData ? JSON.parse(learnedWordsData) : [];
    learnedArticles = learnedArticlesData ? JSON.parse(learnedArticlesData) : [];
    
    updateOnlineStatus();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤ –º–µ–Ω—é
function updateMenuButtons() {
    // –Ø–∑—ã–∫
    document.getElementById('langRu').classList.toggle('active', lang === 'ru');
    document.getElementById('langTr').classList.toggle('active', lang === 'tr');
    document.getElementById('langFa').classList.toggle('active', lang === 'fa');
    
    // –†–µ–∂–∏–º
    document.getElementById('modeArticle').classList.toggle('active', mode === 'article');
    document.getElementById('modeDeToL1').classList.toggle('active', mode === 'de_to_l1');
    document.getElementById('modeL1ToDe').classList.toggle('active', mode === 'l1_to_de');
    
    // –§–∏–ª—å—Ç—Ä—ã
    document.getElementById('filterAll').classList.toggle('active', wordFilter === 'all');
    document.getElementById('filterUnlearned').classList.toggle('active', wordFilter === 'unlearned');
    document.getElementById('filterNoArticle').classList.toggle('active', wordFilter === 'no_article');
    document.getElementById('filterNoWord').classList.toggle('active', wordFilter === 'no_word');
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
function saveName() {
    const nameInput = document.getElementById('playerName');
    playerName = nameInput.value.trim();
    
    if (!playerName) {
        alert('Bitte geben Sie Ihren Namen ein.');
        return;
    }
    
    localStorage.setItem('playerName', playerName);
    document.getElementById('nameBox').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
    loadWords();
    updateVisitCounter();
    updateMenuButtons();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
function updateOnlineStatus() {
    if (playerId && playerName) {
        onlineUsers[playerId] = {
            name: playerName,
            lastSeen: Date.now(),
            sessionStart: startTime
        };
        saveGlobalStats();
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function saveGlobalStats() {
    const now = Date.now();
    Object.keys(onlineUsers).forEach(id => {
        if (now - onlineUsers[id].lastSeen > 5 * 60 * 1000) {
            delete onlineUsers[id];
        }
    });
    
    globalStats.onlineUsers = onlineUsers;
    localStorage.setItem('globalStats', JSON.stringify(globalStats));
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤
function loadWords() {
    try {
        words = wordDictionary.map(w => ({
            article: (w.article || 'das').toLowerCase(),
            word: w.word || '',
            german: `${(w.article || 'das').toLowerCase()} ${w.word || ''}`.trim(),
            translation_ru: w.translation_ru || '',
            translation_tr: w.translation_tr || '',
            translation_fa: w.translation_fa || '',
            id: generateWordId(w)
        })).filter(x => x.word);
        
        applyWordFilter();
        updateLearnedWordsDisplay();
        
    } catch(err) {
        console.error('Error loading words:', err);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤');
    }
}

function generateWordId(word) {
    return `${word.article}_${word.word}`.toLowerCase().replace(/\s+/g, '_');
}

// –§–∏–ª—å—Ç—Ä—ã
function setWordFilter(filter) {
    wordFilter = filter;
    applyWordFilter();
    updateMenuButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
}

function applyWordFilter() {
    if (!words.length) return;
    
    switch(wordFilter) {
        case 'learned':
            filteredWords = words.filter(word => 
                learnedWords.includes(word.id) || learnedArticles.includes(word.id)
            );
            break;
        case 'unlearned':
            filteredWords = words.filter(word => 
                !learnedWords.includes(word.id) && !learnedArticles.includes(word.id)
            );
            break;
        case 'no_article':
            filteredWords = words.filter(word => 
                !learnedArticles.includes(word.id)
            );
            break;
        case 'no_word':
            filteredWords = words.filter(word => 
                !learnedWords.includes(word.id)
            );
            break;
        case 'all':
        default:
            filteredWords = [...words];
            break;
    }
    
    updateWordCountDisplay();
}

function updateWordCountDisplay() {
    const availableCount = filteredWords.length;
    const totalCount = words.length;
    const learnedWordsCount = learnedWords.length;
    const learnedArticlesCount = learnedArticles.length;
    
    const wordCountInfo = document.getElementById('wordCountInfo');
    if (wordCountInfo) {
        wordCountInfo.innerHTML = `
            Verf√ºgbare W√∂rter: <b>${availableCount}</b> / ${totalCount}<br>
            W√∂rter gelernt: ${learnedWordsCount} | Artikel gelernt: ${learnedArticlesCount}
        `;
    }
}

function updateLearnedWordsDisplay() {
    const learnedWordsCount = learnedWords.length;
    const learnedArticlesCount = learnedArticles.length;
    const learnedInfo = document.getElementById('learnedWordsInfo');
    const learnedCountSpan = document.getElementById('learnedCount');
    const learnedArticlesSpan = document.getElementById('learnedArticlesCount');
    
    if (learnedInfo && learnedCountSpan && learnedArticlesSpan) {
        learnedCountSpan.textContent = learnedWordsCount;
        learnedArticlesSpan.textContent = learnedArticlesCount;
        if (learnedWordsCount > 0 || learnedArticlesCount > 0) {
            learnedInfo.style.display = 'block';
        } else {
            learnedInfo.style.display = 'none';
        }
    }
}

// –°–ë–†–û–° –°–¢–ê–¢–£–°–ê –ö–ù–û–ü–û–ö –î–õ–Ø –ù–û–í–û–ì–û –°–õ–û–í–ê
function resetLearningStatusButtons() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    
    const wordBtn = document.getElementById('wordLearnedBtn');
    const wordIcon = document.getElementById('wordLearnedIcon');
    const articleBtn = document.getElementById('articleLearnedBtn');
    const articleIcon = document.getElementById('articleLearnedIcon');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–ª–æ–≤–∞
    if (learnedWords.includes(wordId)) {
        wordBtn.classList.add('word-learned');
        wordIcon.textContent = '‚úÖ';
    } else {
        wordBtn.classList.remove('word-learned');
        wordIcon.textContent = '‚ñ°';
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞—Ä—Ç–∏–∫–ª—è
    if (learnedArticles.includes(wordId)) {
        articleBtn.classList.add('article-learned');
        articleIcon.textContent = '‚úÖ';
    } else {
        articleBtn.classList.remove('article-learned');
        articleIcon.textContent = '‚ñ°';
    }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑—É—á–µ–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ –∞—Ä—Ç–∏–∫–ª—è–º–∏
function toggleWordLearned() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    const btn = document.getElementById('wordLearnedBtn');
    const icon = document.getElementById('wordLearnedIcon');
    
    if (learnedWords.includes(wordId)) {
        learnedWords = learnedWords.filter(id => id !== wordId);
        btn.classList.remove('word-learned');
        icon.textContent = '‚ñ°';
    } else {
        learnedWords.push(wordId);
        btn.classList.add('word-learned');
        icon.textContent = '‚úÖ';
    }
    
    saveLearnedData();
}

function toggleArticleLearned() {
    const currentWord = quizWords[index];
    const wordId = currentWord.id;
    const btn = document.getElementById('articleLearnedBtn');
    const icon = document.getElementById('articleLearnedIcon');
    
    if (learnedArticles.includes(wordId)) {
        learnedArticles = learnedArticles.filter(id => id !== wordId);
        btn.classList.remove('article-learned');
        icon.textContent = '‚ñ°';
    } else {
        learnedArticles.push(wordId);
        btn.classList.add('article-learned');
        icon.textContent = '‚úÖ';
    }
    
    saveLearnedData();
}

function saveLearnedData() {
    localStorage.setItem(`learnedWords_${playerId}`, JSON.stringify(learnedWords));
    localStorage.setItem(`learnedArticles_${playerId}`, JSON.stringify(learnedArticles));
    updateLearnedWordsDisplay();
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ 25-–≥–æ –∫–∞–¥—Ä–∞
function showSubliminalFrame(word) {
    if (!subliminalEnabled) return;
    
    const frame = document.getElementById('subliminalFrame');
    const combinedEl = document.getElementById('subliminalCombined');
    const translationEl = document.getElementById('subliminalTranslation');
    
    combinedEl.textContent = `${word.article} ${word.word}`;
    translationEl.textContent = pickTranslation(word);
    
    frame.classList.add('visible');
    
    setTimeout(() => {
        frame.classList.remove('visible');
    }, subliminalDuration);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    stats.games++;
    stats.totalQuestions += quizWords.length;
    stats.totalCorrect += score;
    if (score > stats.bestScore) {
        stats.bestScore = score;
    }
    localStorage.setItem(`stats_${playerId}`, JSON.stringify(stats));
    
    if (playerId && playerName) {
        if (!globalStats.users) globalStats.users = {};
        globalStats.users[playerId] = {
            name: playerName,
            games: stats.games,
            bestScore: stats.bestScore,
            totalQuestions: stats.totalQuestions,
            totalCorrect: stats.totalCorrect,
            accuracy: stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0,
            learnedWords: learnedWords.length,
            learnedArticles: learnedArticles.length,
            lastActive: new Date().toLocaleDateString()
        };
        saveGlobalStats();
    }
    
    updateStatsDisplay();
}

function updateStatsDisplay() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    const accuracy = stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0;
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–æ –∏–º—è "Gadzera", –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "Ihnen"
    document.getElementById('statsBox').innerHTML = `
        <b>Statistik f√ºr Sie:</b><br>
        Spiele: ${stats.games}<br>
        Bestes Ergebnis: ${stats.bestScore}<br>
        Genauigkeit: ${accuracy}%<br>
        Gelernte W√∂rter: ${learnedWords.length}<br>
        Gelernte Artikel: ${learnedArticles.length}
    `;
}

// –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
function nextQuestion() {
    if (index >= quizWords.length) {
        finishQuiz();
        return;
    }
    
    const q = quizWords[index];
    
    // –°–ë–†–ê–°–´–í–ê–ï–ú –°–¢–ê–¢–£–° –ö–ù–û–ü–û–ö –î–õ–Ø –ù–û–í–û–ì–û –°–õ–û–í–ê
    resetLearningStatusButtons();
    
    document.getElementById('currentQuestion').textContent = index + 1;
    document.getElementById('totalQuestions').textContent = quizWords.length;
    
    const progressPercent = ((index) / quizWords.length) * 100;
    document.getElementById('progressFill').style.width = `${progressPercent}%`;
    
    document.getElementById('articleDisplay').textContent = '';
    document.getElementById('correctAnswerDisplay').textContent = '';
    document.getElementById('translationBox').textContent = '';
    
    let qText = '';
    let opts = [];
    let correct;
    
    if (mode === 'article') {
        qText = `Welcher Artikel passt zu:`;
        document.getElementById('word').innerText = q.word;
        document.getElementById('translationBox').textContent = pickTranslation(q);
        opts = ['der', 'die', 'das'];
        correct = q.article;
    } else if (mode === 'de_to_l1') {
        const g = (q.german || ((q.article || 'das') + ' ' + q.word)).trim();
        qText = `Was bedeutet:`;
        document.getElementById('word').innerText = g;
        const correctT = pickTranslation(q);
        const pool = shuffle(words.map(w => pickTranslation(w)).filter(t => t && t !== correctT));
        opts = pool.slice(0, 3);
        opts.push(correctT);
        correct = correctT;
    } else {
        const trans = pickTranslation(q);
        qText = `Wie hei√üt auf Deutsch:`;
        document.getElementById('word').innerText = trans;
        const correctG = (q.german || ((q.article || 'das') + ' ' + q.word)).trim();
        const pool = shuffle(words.map(w => (w.german || ((w.article || 'das') + ' ' + w.word)).trim()).filter(g => g !== correctG));
        opts = pool.slice(0, 3);
        opts.push(correctG);
        correct = correctG;
    }
    
    opts = shuffle(opts);
    document.getElementById('question').innerText = qText;
    const ans = document.getElementById('answers');
    ans.innerHTML = '';
    
    opts.forEach(opt => {
        const b = document.createElement('button');
        b.textContent = opt;
        b.onclick = () => checkAnswer(b, opt, correct, q);
        ans.appendChild(b);
    });
}

function checkAnswer(button, selected, correct, q) {
    const allButtons = document.querySelectorAll('#answers button');
    allButtons.forEach(btn => {
        btn.onclick = null;
    });

    if (selected === correct) {
        button.style.background = 'green';
        score++;
        
        if (subliminalEnabled) {
            showSubliminalFrame(q);
        }
        
        if (mode === 'article') {
            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï - –ê–†–¢–ò–ö–õ–¨ –°–õ–ï–í–ê –û–¢ –°–õ–û–í–ê
            document.getElementById('articleDisplay').textContent = q.article;
            document.getElementById('articleDisplay').style.color = '#22c55e';
        } else {
            showCorrectAnswer(correct);
        }
    } else {
        button.style.background = 'red';
        allButtons.forEach(btn => {
            if (btn.textContent === correct) {
                btn.style.background = 'green';
            }
        });
        
        if (subliminalEnabled) {
            showSubliminalFrame(q);
        }
        
        if (mode === 'article') {
            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï - –ê–†–¢–ò–ö–õ–¨ –°–õ–ï–í–ê –û–¢ –°–õ–û–í–ê
            document.getElementById('articleDisplay').textContent = q.article;
            document.getElementById('articleDisplay').style.color = '#22c55e';
        } else {
            showCorrectAnswer(correct);
        }
    }
    
    setTimeout(() => {
        index++;
        nextQuestion();
    }, 1500);
}

function showCorrectAnswer(answer) {
    const el = document.getElementById('correctAnswerDisplay');
    el.textContent = answer;
    el.style.color = '#22c55e';
}

function pickTranslation(item) {
    if (lang === 'tr') return item.translation_tr || item.translation_ru || '';
    if (lang === 'fa') return item.translation_fa || item.translation_ru || '';
    return item.translation_ru || item.translation_tr || item.translation_fa || '';
}

function finishQuiz() {
    document.getElementById('quiz').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    const accuracy = (score / quizWords.length * 100).toFixed(1);
    document.getElementById('score').innerText = `${score} / ${quizWords.length} (${accuracy}%)`;
    
    const resultStats = document.getElementById('resultStats');
    resultStats.innerHTML = `
        <div style="margin: 15px 0;">
            <strong>Gelernte W√∂rter in diesem Spiel:</strong> ${learnedWords.length}<br>
            <strong>Gelernte Artikel in diesem Spiel:</strong> ${learnedArticles.length}
        </div>
    `;
    
    updateStats();
}

function showStats() {
    const stats = JSON.parse(localStorage.getItem(`stats_${playerId}`) || '{"games": 0, "bestScore": 0, "totalQuestions": 0, "totalCorrect": 0}');
    const accuracy = stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0;
    
    document.getElementById('detailedStats').innerHTML = `
        <div style="text-align: left; line-height: 1.6;">
            <h3>üìà Detaillierte Statistik</h3>
            <p><strong>Gesamtspiele:</strong> ${stats.games}</p>
            <p><strong>Beste Punktzahl:</strong> ${stats.bestScore}</p>
            <p><strong>Gesamtfragen:</strong> ${stats.totalQuestions}</p>
            <p><strong>Richtige Antworten:</strong> ${stats.totalCorrect}</p>
            <p><strong>Genauigkeit:</strong> ${accuracy}%</p>
            <p><strong>Gelernte W√∂rter:</strong> ${learnedWords.length}</p>
            <p><strong>Gelernte Artikel:</strong> ${learnedArticles.length}</p>
            <p><strong>Verf√ºgbare W√∂rter:</strong> ${words.length}</p>
        </div>
    `;
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('stats').style.display = 'block';
}

function backToMenu() {
    document.getElementById('quiz').style.display = 'none';
    document.getElementById('result').style.display = 'none';
    document.getElementById('stats').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
}

function restart() {
    document.getElementById('result').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
    applyWordFilter();
}

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function startSessionTimer() {
    setInterval(() => {
        document.getElementById('info').innerHTML = `<span>Sprache: ${getLanguageName(lang)}</span> ‚Ä¢ <span>Modus: ${getModeName(mode)}</span>`;
    }, 1000);
}

function getLanguageName(lang) {
    const names = {
        'ru': '–†—É—Å—Å–∫–∏–π',
        'tr': 'T√ºrk√ße',
        'fa': 'ŸÅÿßÿ±ÿ≥€å'
    };
    return names[lang] || '–†—É—Å—Å–∫–∏–π';
}

function getModeName(mode) {
    const names = {
        'article': 'Artikel w√§hlen',
        'de_to_l1': 'Deutsch ‚Üí √úbersetzung',
        'l1_to_de': '√úbersetzung ‚Üí Deutsch'
    };
    return names[mode] || 'Artikel w√§hlen';
}

function setLang(language) {
    lang = language;
    updateStatsDisplay();
    updateMenuButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
}

function setMode(gameMode) {
    mode = gameMode;
    updateStatsDisplay();
    updateMenuButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
}

function startQuiz() {
    if (!filteredWords.length) {
        alert(`Keine W√∂rter verf√ºgbar f√ºr den ausgew√§hlten Filter (${wordFilter}). Bitte w√§hlen Sie einen anderen Filter.`);
        return;
    }
    
    let qCount = parseInt(document.getElementById('qCount').value) || 10;
    qCount = Math.max(5, Math.min(100, qCount));
    
    const pool = shuffle([...filteredWords]);
    quizWords = pool.slice(0, Math.min(qCount, pool.length));
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('quiz').style.display = 'block';
    
    index = 0;
    score = 0;
    
    nextQuestion();
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 25-–≥–æ –∫–∞–¥—Ä–∞
function loadSubliminalSettings() {
    const saved = localStorage.getItem('subliminalEnabled');
    if (saved !== null) {
        subliminalEnabled = JSON.parse(saved);
    }
    document.getElementById('subliminalToggle').checked = subliminalEnabled;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    loadPlayerData();
    updateStatsDisplay();
    startSessionTimer();
    loadSubliminalSettings();
    
    document.getElementById('subliminalToggle').addEventListener('change', function(e) {
        subliminalEnabled = e.target.checked;
        localStorage.setItem('subliminalEnabled', subliminalEnabled);
    });
    
    setInterval(updateOnlineStatus, 60000);
}

window.onload = init;
    </script>

    <div style="text-align: center; padding: 15px; color: #666; font-size: 12px;">
        powered by Aleksandr Gadzera ‚Ä¢ @ale11111
    </div>

</body>
</html>
